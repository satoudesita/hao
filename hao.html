<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出席登録</title>
    <style>
        body {
            font-family: 'Helvetica', sans-serif;
            background-color: #e8f5e9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        h2,
        h3 {
            text-align: center;
            color: #388e3c;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #a5d6a7;
            border-radius: 8px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            background-color: #66bb6a;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #43a047;
        }

        .output,
        #attendanceResult {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #388e3c;
        }

        .logout-btn {
            background-color: #ff7043;
        }

        .logout-btn:hover {
            background-color: #e64a19;
        }

        .delete-btn {
            background-color: #ff7043;
        }

        .delete-btn:hover {
            background-color: #e64a19;
        }

        .user-icon-container {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        #userIcon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #a5d6a7;
        }

        #userIcon:hover {
            border-color: #66bb6a;
        }

        .user-info-card {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f1f8e9;
            border: 1px solid #a5d6a7;
            border-radius: 12px;
            padding: 15px;
            margin: 20px auto;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .user-info-card img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            border: 2px solid #a5d6a7;
        }

        .user-details h2 {
            font-size: 18px;
            color: #388e3c;
            margin: 0;
        }

        .user-details p {
            font-size: 14px;
            color: #66bb6a;
            margin: 0;
        }

        .settings-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px auto 0;
            width: 60px;
            height: 40px;
            border-radius: 12px;
            background-color: #66bb6a;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .settings-btn:hover {
            background-color: #43a047;
        }

        #settings-screen {
            display: none;
        }

        .current-time {
            font-size: 18px;
            font-weight: bold;
            color: #eb6c04;
            text-align: center;
            margin-top: 10px;
        }

        #loggedInUserDisplay {
            text-align: center;
            font-size: 16px;
            color: #388e3c;
            margin-top: 10px;
        }

        .contact-btn {
            background-color: #42a5f5;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        .contact-btn:hover {
            background-color: #1e88e5;
        }

        #lateCountDisplay {
            text-align: center;
            font-size: 16px;
            color: #d32f2f;
            margin-top: 10px;
        }
    </style>
</head>

<body onload="init()">
    <div class="container" id="login-screen">
        <h2>ログイン</h2>

        <h3>生徒ログイン</h3>
    <input type="text" id="username" placeholder="生徒ユーザー名" />
    <input type="password" id="password" placeholder="パスワード" />
    <input type="text" id="studentId" placeholder="学籍番号" />
        <button onclick="login()">ログイン</button>

        <h3>生徒新規登録</h3>
        <input type="text" id="newUsername" placeholder="生徒ユーザー名" />
    <input type="password" id="newPassword" placeholder="パスワード" />
    <input type="text" id="newStudentId" placeholder="学籍番号" />
        <button onclick="register()">登録</button>

    </div>

    <div class="container" id="main-screen" style="display:none;">
        <h2>出席確認(8:10まで)</h2>
        <button onclick="save('出席')">出席登録</button>
        <p id="attendanceResult"></p>
        <p class="output">位置情報を取得中...</p>
        <button onclick="goBack()">戻る</button>
    </div>

    <div class="container" id="late-screen" style="display:none;">
        <h2>遅刻確認(8:10から)</h2>
        <input type="text" id="reason" placeholder="理由" />
        <button onclick="savelate('遅刻')">遅刻登録</button>
        <p id="attendanceResult"></p>
        <p class="output1">位置情報を取得中...</p>
        <button onclick="goBack()">戻る</button>
    </div>

    <div class="container" id="select-screen" style="display:none;">
        <h2>選択画面</h2>
        <p id="currentTime" class="current-time"></p>
        <p id="loggedInUserDisplay"></p>
        <p id="lateCountDisplay">遅刻回数: 0</p>
        <div style="text-align:center; margin:10px 0;">
            <button id="startUsageBtn" onclick="startUsageTimer()">利用時間開始</button>
            <div id="usageTimer" style="margin-top:8px; font-weight:bold;">利用時間: 0.0 秒</div>
        </div>
    <button onclick="syusseki()">出席</button>
    <button onclick="late()">遅刻</button>
        <p id="attendanceResult"></p>
    </div>

    <div class="container" id="settings-screen" style="display:none;">
        <h2>⚙︎ 設定画面 ⚙︎</h2>
        <p id="lateCountDisplay">遅刻回数: 0</p>
        <button class="logout-btn" onclick="logout()">ログアウト</button>
        <button class="delete-btn" onclick="deleteAccount()">アカウント削除</button>
        <button class="contact-btn" onclick="contactUs()">お問い合わせ</button>
        <button onclick="closeSettings()">戻る</button>
    </div>



    <div class="user-icon-container">
        <img id="userIcon" src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_13.png"
            alt="ユーザーアイコン" onclick="triggerPhotoUpload()" />
        <input type="file" id="photoUpload" accept="image/*" style="display: none;" onchange="uploadPhoto()" />
        <button class="settings-btn" onclick="openSettings()">設定</button>
    </div>

    <div class="user-info-card" style="display:none;">
        <img id="userIcon" src="https://kotonohaworks.com/free-icons/wp-content/uploads/kkrn_icon_user_13.png"
            alt="ユーザーアイコン" />
        <div class="user-details">
            <h2 id="loggedInUserDisplay">未設定</h2>
            <p>ログイン中のユーザー</p>
        </div>
    </div>

    <script>
        const baserow = {
            url:"https://api.baserow.io/api/database/rows/table/685053/",
            lateurl:"https://api.baserow.io/api/database/rows/table/691308/",
            templateurl:"https://api.baserow.io/api/database/rows/table/709073/",
            usermanageurl:"https://api.baserow.io/api/database/rows/table/709165/",
            token: "Token z8Du55WVQi6wmFT3Ta6diQUSUxCqx8WR"
            }
        const targetLat = 33.244765;
        const targetLng = 131.62293;

        function syusseki() {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("main-screen").style.display = "block";
            document.getElementById("select-screen").style.display = "none";

            getLocation();

            const user = localStorage.getItem("loggedInUser");
            if (user) {
                document.getElementById("attendanceResult").textContent = `ログイン中のユーザー: ${user}`;
            }

        }

        function late() {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("main-screen").style.display = "none";
            document.getElementById("select-screen").style.display = "none";
            document.getElementById("late-screen").style.display = "block";

            getLocation();

            const user = localStorage.getItem("loggedInUser");
            if (user) {
                document.getElementById("attendanceResult").textContent = `ログイン中のユーザー: ${user}`;
            }

        }

        async function hashPassword(password) {
            const enc = new TextEncoder().encode(password);
            const hashBuffer = await crypto.subtle.digest("SHA-256", enc);
            return Array.from(new Uint8Array(hashBuffer))
                .map(b => b.toString(16).padStart(2, "0"))
                .join("");
        }

        function getUsers() {
            return JSON.parse(localStorage.getItem("USERS") || "{}");
        }

        function getStudentId(username) {
            const users = getUsers();
            const entry = users[username];
            if (!entry) return "";
            if (typeof entry === 'string') return ""; // old-format users have no studentId
            return entry.studentId || "";
        }

        function saveUsers(users) {
            localStorage.setItem("USERS", JSON.stringify(users));
        }

        async function register() {
            const newUser = document.getElementById("newUsername").value;
            const newPass = document.getElementById("newPassword").value;
            const newStudentId = document.getElementById("newStudentId").value;
            const users = getUsers();
            if (users[newUser]) {
                alert("すでに登録されています");
                return;
            }
            const hashed = await hashPassword(newPass);
            // ユーザー情報をオブジェクトで保存（password, studentId）
            users[newUser] = { password: hashed, studentId: newStudentId || "" };
            saveUsers(users);
            alert("登録完了");
            // Baserow の usermanage テーブルにも Name を追加
            fetch(baserow.usermanageurl + '?user_field_names=true', {
                method: 'POST',
                headers: {
                    'Authorization': baserow.token,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ Name: newUser })
            })
            .then(res => res.json())
            .then(data => console.log('Baserow usermanage 送信成功:', data))
            .catch(err => console.error('Baserow usermanage 送信エラー:', err));
        }

        async function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const inputStudentId = document.getElementById("studentId").value;
            const users = getUsers();
            const hashed = await hashPassword(password);
            const entry = users[username];
            if (!entry) {
                alert("ユーザー名またはパスワードが違います");
                return;
            }
            // 既存互換：entry が文字列なら旧形式（ハッシュ）
            if (typeof entry === 'string') {
                if (entry === hashed) {
                    // マイグレーション：オブジェクト形式へ変換（studentId は入力があれば採用）
                    users[username] = { password: entry, studentId: inputStudentId || "" };
                    saveUsers(users);
                    localStorage.setItem("loggedInUser", username);
                    showMain();
                    return;
                }
            } else if (typeof entry === 'object') {
                if (entry.password === hashed) {
                    // studentId が入力されていれば保存（任意）
                    if (inputStudentId && inputStudentId !== entry.studentId) {
                        entry.studentId = inputStudentId;
                        users[username] = entry;
                        saveUsers(users);
                    }
                    localStorage.setItem("loggedInUser", username);
                    showMain();
                    return;
                }
            }
            alert("ユーザー名またはパスワードが違います");
        }

        function showMain() {
           
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("main-screen").style.display = "none";
            document.getElementById("select-screen").style.display = "block";

            const user = localStorage.getItem("loggedInUser");
            if (user) {
                document.getElementById("attendanceResult").textContent = `ログイン中のユーザー: ${user}`;
                document.getElementById("loggedInUserDisplay").textContent = `ログイン中のユーザー: ${user}`;
            }

           
            if (document.getElementById("currentTime")) {
                updateCurrentTime();
                setInterval(updateCurrentTime, 1000);
            }
        }

        function logout() {
            if (confirm("本当にログアウトしますか？")) {
                localStorage.removeItem("loggedInUser");
                location.reload();
            }
        }

        


        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3;
            const toRad = Math.PI / 180;
            const dLat = (lat2 - lat1) * toRad;
            const dLng = (lng2 - lng1) * toRad;
            const a =
                Math.sin(dLat / 2) ** 2 +
                Math.cos(lat1 * toRad) *
                Math.cos(lat2 * toRad) *
                Math.sin(dLng / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function getLocation() {
            if (!navigator.geolocation) {
                document.querySelector(".output").textContent =
                    "このブラウザでは位置情報が使えません。";
                document.querySelector(".output1").textContent =
                    "このブラウザでは位置情報が使えません。";
                return;
            }
            navigator.geolocation.getCurrentPosition(
                position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const distance = calculateDistance(lat, lng, targetLat, targetLng);
                    const message = distance < 100
                        ? `距離: ${Math.ceil(distance)}m 学校の中にいます`
                        : `距離: ${Math.ceil(distance)}m 学校の外にいます`;
                    document.querySelector(".output").textContent = message;
                    document.querySelector(".output1").textContent = message;
                },
                error => {
                    document.querySelector(".output").textContent =
                        `位置情報の取得に失敗: ${error.message}`;
                    document.querySelector(".output1").textContent =
                        `位置情報の取得に失敗: ${error.message}`;
                }
            );
        }

        
        let usageStartMs = null;
        let usageElapsedMs = 0;
        let usageIntervalId = null;

        function formatElapsedMs(ms) {
            
            return (ms / 1000).toFixed(1);
        }

        function startUsageTimer() {
            if (usageIntervalId) return; 
            usageStartMs = performance.now();
            usageIntervalId = setInterval(() => {
                usageElapsedMs = performance.now() - usageStartMs;
                const el = document.getElementById('usageTimer');
                if (el) el.textContent = `利用時間: ${formatElapsedMs(usageElapsedMs)} 秒`;
            }, 100); 
            // ボタンを無効化して二重開始を防ぐ
            const btn = document.getElementById('startUsageBtn');
            if (btn) btn.disabled = true;
        }

        function stopUsageTimer() {
            if (!usageIntervalId) return usageElapsedMs;
            clearInterval(usageIntervalId);
            usageIntervalId = null;
            usageElapsedMs = performance.now() - usageStartMs;
            usageStartMs = null;
            const btn = document.getElementById('startUsageBtn');
            if (btn) btn.disabled = false;
            const el = document.getElementById('usageTimer');
            if (el) el.textContent = `利用時間: ${formatElapsedMs(usageElapsedMs)} 秒`;
            return usageElapsedMs;
        }

        function save(statusType) {
            // 利用時間タイマーを停止して表示
            const elapsed = stopUsageTimer();
            const username = localStorage.getItem("loggedInUser");
            if (!username) {
                alert("ログインされていません");
                return;
            }

            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();

            if (currentHour < 6 || currentHour > 8 || (currentHour === 8 && currentMinute > 10)) {
                alert("出席登録は6:00から8:10まで可能です。");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const distance = calculateDistance(lat, lng, targetLat, targetLng);

                    // 学校から200m以上離れている場合は登録禁止
                    if (distance >= 200) {
                        alert("学校外では登録できません。");
                        return;
                    }

                    const locationText = "学校内";
                    const timeStr = new Date().toLocaleDateString()

                    // ローカル保存
                    const attendance = JSON.parse(localStorage.getItem("ATTENDANCE") || "[]");
                    attendance.push({
                        username: username,
                        status: statusType + "済み",
                        time: timeStr,
                        location: locationText
                    });
                    localStorage.setItem("ATTENDANCE", JSON.stringify(attendance));

                    // 画面表示更新
                    document.getElementById("attendanceResult").textContent =
                        `${statusType}完了：${username}（${locationText}・${timeStr}）`;

                    // Baserowへ送信（利用時間をUseTimeとして渡す）
                    sendMessage(username, timeStr, elapsed);
                },
                error => {
                    alert("位置情報が取得できませんでした: " + error.message);
                }
            );
        }

        function sendMessage(username, timeStr, useMs) {
            const studentId = getStudentId(username);
            const useTime = useMs ? formatElapsedMs(useMs) : null;
            fetch(baserow.url + '?user_field_names=true', {
                method: 'POST',
                headers: {
                    'Authorization': baserow.token,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    Name: username,
                    Date: timeStr,
                    Number: studentId,
                    UseTime: useTime
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Baserow送信成功:', data);
                })
                .catch(error => {
                    console.error('Baserow送信エラー:', error);
                });
        }

        function savelate(statusType) {
            // 利用時間タイマーを停止（alert は表示しない）
            const elapsed = stopUsageTimer();
            const username = localStorage.getItem("loggedInUser");
            const reason = document.getElementById("reason").value;

            if (!username) {
                alert("ログインされていません");
                return;
            }

            const button = document.querySelector("#late-screen button");
            button.textContent = "登録中...";
            button.disabled = true;

            navigator.geolocation.getCurrentPosition(
                position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const distance = calculateDistance(lat, lng, targetLat, targetLng);

                    if (distance >= 10000) {
                        alert("学校外では遅刻登録できません。");
                        button.textContent = "遅刻登録失敗";
                        button.disabled = false;
                        return;
                    }

                    const locationText = "学校内";
                    const now = new Date();
                    const timeStr = new Date().toLocaleDateString();
                    // 時:分:秒 を作成
                    const timeHms = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
                    const attendance = JSON.parse(localStorage.getItem("ATTENDANCE") || "[]");

                    attendance.push({
                        username: username,
                        status: statusType + "済み",
                        time: timeStr,
                        location: locationText,
                        reason: reason
                    });

                    localStorage.setItem("ATTENDANCE", JSON.stringify(attendance));

                    const lateCount = parseInt(localStorage.getItem("LATE_COUNT") || "0");
                    localStorage.setItem("LATE_COUNT", lateCount + 1);

                    document.getElementById("attendanceResult").textContent =
                        `${statusType}完了：${username}（${locationText}・${timeStr}・理由：${reason}）`;

                    button.textContent = "遅刻登録完了";
                    button.disabled = false;

                    // UseTime を一緒に渡す
                    sendlateMessage(username, timeStr, reason, timeHms, elapsed);
                },
                error => {
                    alert("位置情報が取得できませんでした: " + error.message);
                    button.textContent = "遅刻登録失敗";
                    button.disabled = false;
                }
            );
        }

        function sendlateMessage(username, timeStr, reason, timeHms, useMs) {
            const studentId = getStudentId(username);
            const useTime = useMs ? formatElapsedMs(useMs) : null;
            fetch(baserow.templateurl + '?user_field_names=true', {
                method: 'POST',
                headers: {
                    'Authorization': baserow.token,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    Name: username,
                    Date: timeStr,
                    Reason: reason,
                    Number: studentId,
                    Time: timeHms,
                    UseTime: useTime
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Baserow送信成功:', data);
                })
                .catch(error => {
                    console.error('Baserow送信エラー:', error);
                });

            // Power Automate にも同じ形式で送信
            const powerAutomateUrl = 'https://defaulta15ae2a081b2404dba2d91d6abf65c.96.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/45e0342f8f3f48208cef4d400691a440/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=eNo98Si76YqDLeZjelujDuPBdlOJ_sU-6uypXyfYygo';
            const paBody = {
                Name: username,
                Date: timeStr,
                Reason: reason,
                Number: studentId,
                Time: timeHms,
                UseTime: useTime
            };
            fetch(powerAutomateUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(paBody)
            })
                .then(res => {
                    if (!res.ok) throw new Error('Power Automate response not ok: ' + res.status);
                    return res.text();
                })
                .then(text => console.log('Power Automate送信成功:', text))
                .catch(err => console.error('Power Automate送信エラー:', err));
        }

        function deleteAccount() {
            const username = localStorage.getItem("loggedInUser");
            if (!username) {
                alert("ログインされていません");
                return;
            }

            const users = getUsers();
            if (!users[username]) {
                alert("アカウントが見つかりません");
                return;
            }

            if (confirm("本当にアカウントを削除しますか？")) {
                // まずローカルから削除
                delete users[username];
                saveUsers(users);
                localStorage.removeItem("loggedInUser");

                // Baserow の usermanage から該当 Name を削除していく
                fetch(baserow.usermanageurl + '?user_field_names=true')
                    .then(res => res.json())
                    .then(data => {
                        // data は配列のはず。Name フィールドが一致する行を探す
                        const matches = data.filter(row => row.Name === username);
                        if (matches.length === 0) {
                            console.log('Baserow usermanage: 該当ユーザーなし');
                            alert('アカウントを削除しました');
                            location.reload();
                            return;
                        }
                        // 各行を削除
                        Promise.all(matches.map(row => {
                            const deleteUrl = baserow.usermanageurl + row.id + '/';
                            return fetch(deleteUrl, { method: 'DELETE', headers: { 'Authorization': baserow.token } })
                                .then(r => {
                                    if (!r.ok) throw new Error('delete failed ' + r.status);
                                    return r.text();
                                });
                        }))
                        .then(() => {
                            console.log('Baserow usermanage: 削除完了');
                            alert('アカウントを削除しました');
                            location.reload();
                        })
                        .catch(err => {
                            console.error('Baserow usermanage delete error', err);
                            alert('アカウントはローカルで削除されましたが、リモート削除に失敗しました');
                            location.reload();
                        });
                    })
                    .catch(err => {
                        console.error('Baserow usermanage fetch error', err);
                        alert('アカウントはローカルで削除されましたが、リモート確認に失敗しました');
                        location.reload();
                    });
            }
        }

        function goBack() {
            document.getElementById("main-screen").style.display = "none";
            document.getElementById("late-screen").style.display = "none";
            document.getElementById("select-screen").style.display = "block";
        }

        function triggerPhotoUpload() {
            document.getElementById("photoUpload").click();
        }

        function uploadPhoto() {
            const fileInput = document.getElementById("photoUpload");
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const photoData = e.target.result;
                    document.getElementById("userIcon").src = photoData;
                    localStorage.setItem("userPhoto", photoData);
                };
                reader.readAsDataURL(file);
            }
        }

        function init() {
            const user = localStorage.getItem("loggedInUser");
            const userPhoto = localStorage.getItem("userPhoto");

            if (userPhoto) {
                document.getElementById("userIcon").src = userPhoto;
            }

            if (user) {
                document.getElementById("loggedInUserDisplay").textContent = `生徒: ${user}`;
                document.querySelector(".user-icon-container").style.display = "block";
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("select-screen").style.display = "block";
            } else {
                document.querySelector(".user-icon-container").style.display = "none";
                document.getElementById("login-screen").style.display = "block";
                document.getElementById("select-screen").style.display = "none";
            }
        }

        function openSettings() {
            updateLateCountDisplay();
            document.getElementById("select-screen").style.display = "none";
            document.getElementById("settings-screen").style.display = "block";
        }

        function closeSettings() {
            document.getElementById("settings-screen").style.display = "none";
            document.getElementById("select-screen").style.display = "block";
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeStr = now.getFullYear() + "-" +
                String(now.getMonth() + 1).padStart(2, '0') + "-" +
                String(now.getDate()).padStart(2, '0') + " " +
                String(now.getHours()).padStart(2, '0') + ":" +
                String(now.getMinutes()).padStart(2, '0') + ":" +
                String(now.getSeconds()).padStart(2, '0');
            document.getElementById("currentTime").textContent = `現在の時刻: ${timeStr}`;
        }

        function contactUs() {
            window.location.href = "https://forms.cloud.microsoft/r/cjkasq1AaA";
        }

        function updateLateCountDisplay() {
            const lateCount = parseInt(localStorage.getItem("LATE_COUNT") || "0");
            document.getElementById("lateCountDisplay").textContent = `遅刻回数: ${lateCount}`;
        }


    


    </script>
</body>

</html>